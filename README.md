# Express js 웹 서버 도커라이징
- 모든 도커 컨테이너는 이미지에 기반을 두며, 이미지는 도커로 배포하고 실행하기 위한 모든 것의 기반을 제공한다.
- 하나의 컨테이너를 실행하려면 공개된 이미지를 먼저 다운받거나 직접 이미지를 만들어야한다.
- 따라서 이 프로젝트는 node js에서 제공하는 가장 강력한 프레임 워크 중 하나인 express js 프레임 워크와 관련된 이미지를 제작하여 아마존 리눅스 웹 서버에 도커를 사용하여 배포하는 것을 목적으로 한다.

### Dockerfile
- Dockerfile은 Docker 이미지 생성을 위한 일종의 배치 파일이라고 볼 수 있다. 특정 이미지를 기준으로 새로운 이미지 구성에 필요한 명령어들을 저장해놓은 파일이다.
- 기본이미지를 기반으로 원하는 구성요소를 갖춘 실행 환경까지 구축하기 위해 필요한 과정들을 코드화해서 처리할 수 있도록 Docker에서는 간단한 명령들을 지원하고 있고 각각의 명령에 대해 새로운 레이어를 생성하게 된다.

### Dockerfile 작성법
- 어떤 이미지로부터 새로운 이미지를 생성할지를 지정

        FROM node:6.2.2

- Dockerfile 을 생성/관리하는 사람

        MAINTAINER Jaeha Ahn <eu81273@gmail.com>

- app 디렉토리 생성

        RUN mkdir -p /app

- app 디렉토리를 WORKDIR 로 설정

        WORKDIR /app

- 현재 Dockerfile 있는 경로의 모든 파일을 /app 에 복사

        ADD . /app

- npm install 을 실행

        RUN npm install

- 환경변수 NODE_ENV 의 값을 development 로 설정**

        ENV NODE_ENV development

- 가상 머신에 오픈할 포트

         EXPOSE 3000 80

- 컨테이너에서 실행될 명령을 지정

         CMD ["npm", "start"]

###  Dockerfile 빌드하기
-  $ docker build -t 레파지토리명/이미지명:태그명 빌드대상디렉토리

          build 명령을 사용해서 Dockfile을 빌드할 수 있다.
          위와 같이 원하는 레파지토리명과 이미지명, 태그명을 지정하고 빌드대상디렉토리를 지정해서 실행하면 ockerfile을 기반으로 Docker 이미지가 생성된다.

###  Dockerfile로 생성한 뒤 실행하기
- $ docker run -d -p 8080:3000 생성한이미지/태그명
         생성된 이미지로 컨테이너를 실행할 때는 run 명령어를 사용하는 데, 우리가 예제로 만든 프로젝트는 포트번호를 지정해줄 필요가 있기 때문에 -p 옵션을 추가해서 실행해야 한다.
         외부에서 8080포트로 접근하면 내부에서는 3000으로 연결하게 된다. 우리가 예제로 만든 프로젝트의 경우 개발 모드에서는 3000번 포트로 실행되는데 이렇게 옵션을 활용해서 외부와 내부 포트를 연결해 줄 수 있다.

### 결론

 - 간단한 node js application을 위한 Dockerfile을 직접 작성하여 Docker 기반으로 node js application을 배포하기 위한 프로젝트를 진행하였다. 로컬에 있는 소스코드를 기반으로 Docker 이미지를 생성했지만, Dockerfile에 소스코드를 Git에서 가져오는 부분까지 추가한다면 로컬의 상태와 관계없이 Dockerfile 만으로 해당 애플리케이션이 실행되기 위한 모든 요소를 구성하고 실행까지 할 수 있다는 것을 알 수 있었다.

 - 많은 경우 이런방식으로 커밋된 소스를 git에서 받아 Docker 이미지를 생성하고 생성된 이미지를 기준으로 테스트를 수행해서 테스트를 통과하면 운영에 배포하는 형태로 개발과 배포까지의 프로세스를 Docker 기반으로 만들어 활용하고 있다.
